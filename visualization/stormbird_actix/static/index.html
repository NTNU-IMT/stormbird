<!DOCTYPE html>
<html>
<head>
    <title>Simulation Visualization</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        #plot {
            width: 100%;
            height: 600px;
        }
    </style>
</head>
<body>
    <div id="plot"></div>
    <script>
        let trace = {
            x: [],
            y: [],
            type: 'scatter',
            mode: 'lines+markers'
        };

        let layout = {
            title: 'Real-time Simulation Data 2',
            xaxis: { title: 'Time' },
            yaxis: { title: 'Value' }
        };

        Plotly.newPlot('plot', [trace], layout);

        // Initialize data from server
        fetch('/data')
            .then(response => response.json())
            .then(data => {
                trace.x = data.map(point => point.x);
                trace.y = data.map(point => point.y);
                Plotly.redraw('plot');
            });

        // WebSocket connection for real-time updates
        const ws = new WebSocket('ws://localhost:8080/ws');
        
        ws.onmessage = function(event) {
            const point = JSON.parse(event.data);
            trace.x.push(point.x);
            trace.y.push(point.y);
            
            // Keep only last 1000 points in plot
            if (trace.x.length > 1000) {
                trace.x.shift();
                trace.y.shift();
            }
            
            Plotly.redraw('plot');
        };
    </script>
</body>
</html>